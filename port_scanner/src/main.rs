use tokio::net::TcpStream;
use std::time::Duration;
use tokio::time::timeout;

#[tokio::main] // р╕зр╣Йр╕▓р╕зр╕Чр╕╡р╣И 1: р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ main р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╕гр╕░р╕Ър╕Ъ Async
async fn main() {
    let ip = "8.8.8.8";
    let mut tasks = vec![];

    println!("ЁЯЪА р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щр╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕зр╕кр╕╣р╕Зр╕Ър╕Щ {} (р╕Юр╕нр╕гр╣Мр╕Х 1-100)...", ip);

    for port in 1..=100 {
        let target = format!("{}:{}", ip, port);
        
        // р╕зр╣Йр╕▓р╕зр╕Чр╕╡р╣И 2: р╣Гр╕Кр╣Й tokio::spawn р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕▒р╣Ир╕Зр╕Зр╕▓р╕Щр╣Бр╕Ър╕Ъ "р╕вр╕┤р╕Зр╕гр╕▒р╕з" р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕нр╕Бр╕▒р╕Щ
        let task = tokio::spawn(async move {
            let connect_future = TcpStream::connect(&target);
            
            // р╕Хр╕▒р╣Йр╕Зр╣Ар╕зр╕ер╕▓ Timeout 800ms р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Хр╕нр╕Ър╣Гр╕Щр╣Ар╕зр╕ер╕▓р╕Щр╕╡р╣Йр╣Гр╕лр╣Йр╕Вр╣Йр╕▓р╕бр╣Ар╕ер╕в
            match timeout(Duration::from_millis(800), connect_future).await {
                Ok(Ok(_)) => println!("тЬЕ Port {} is OPEN", port),
                _ => {} // р╕Цр╣Йр╕▓р╕Ыр╕┤р╕Фр╕лр╕гр╕╖р╕нр╕лр╕бр╕Фр╣Ар╕зр╕ер╕▓р╕Бр╣Зр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Бр╕кр╕Фр╕Зр╕нр╕░р╣Др╕г
            }
        });
        tasks.push(task);
    }

    // р╕гр╕нр╣Гр╕лр╣Йр╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╕Чр╕╕р╕Бр╕Др╕Щр╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕кр╕гр╣Зр╕И
    for task in tasks {
        let _ = task.await;
    }

    println!("ЁЯПБ р╕кр╣Бр╕Бр╕Щр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щр╕ар╕▓р╕вр╣Гр╕Щр╕Юр╕гр╕┤р╕Ър╕Хр╕▓!");
}